; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[env:electrosmith_daisy]
platform = ststm32
board = electrosmith_daisy
framework = arduino

; Use the vendored (and patched) DaisyDuino in lib/DaisyDuino.
; This avoids losing local fixes when PlatformIO re-downloads dependencies.
lib_deps =

; Daisy Seed can enumerate as a USB DFU device (0483:df11). In that case
; ST-Link/OpenOCD upload will fail with "Error: open failed".
; This config uses dfu-util to flash the built .bin to internal flash.
upload_protocol = custom
; Note: we intentionally omit ":leave" because some STM32 DFU implementations
; disconnect early and dfu-util reports a non-zero exit code after a successful
; transfer. Reset/power-cycle the board after upload to run the new firmware.
upload_command = $PROJECT_PACKAGES_DIR/tool-dfuutil/bin/dfu-util -a 0 -d 0483:df11 -s 0x08000000 -D $SOURCE

build_flags = 
    -std=c++17
    -DHAL_SDRAM_MODULE_ENABLED
    -DHAL_FMC_MODULE_ENABLED

extra_scripts =
    pre:scripts/enable_sdram_hal.py
